# TCP vs UDP 비교

## 개요

TCP와 UDP는 전송 계층의 대표적인 프로토콜입니다. 각각의 특성을 이해하고 상황에 맞게 선택하는 것이 중요합니다.

## 핵심 비교

### 1. 전체 비교표

| 특성 | TCP | UDP |
|------|-----|-----|
| **연결 방식** | 연결 지향 (3-Way Handshake) | 비연결형 |
| **신뢰성** | 보장 (ACK, 재전송) | 비보장 |
| **순서 보장** | 보장 (Sequence Number) | 비보장 |
| **흐름 제어** | 있음 (Sliding Window) | 없음 |
| **혼잡 제어** | 있음 (Slow Start 등) | 없음 |
| **속도** | 상대적 느림 | 빠름 |
| **헤더 크기** | 20~60 bytes | 8 bytes |
| **전송 단위** | Segment | Datagram |
| **통신 방식** | 1:1 | 1:1, 1:N, N:N |
| **사용 예** | HTTP, HTTPS, FTP, SMTP | DNS, DHCP, 스트리밍, 게임 |

### 2. 연결 설정 비교

#### TCP
```
Client                    Server
   |  -- SYN ---------->     |
   |  <--- SYN + ACK ---     |
   |  -- ACK ---------->     |
   |     [연결 수립]          |
   |  -- Data --------->     |
   |  <--- ACK ---------     |
```

#### UDP
```
Client                    Server
   |  -- Data --------->     |
   |  -- Data --------->     |
   |  -- Data --------->     |
```

**핵심 차이**: TCP는 연결 설정에 1.5 RTT 필요, UDP는 즉시 전송

### 3. 데이터 전송 비교

#### TCP - 신뢰성 있는 전송
```
송신: [1][2][3][4][5]
       ↓
네트워크: [2] 손실
       ↓
수신: [1][_][3][4][5]
       ↓
ACK: "2번 없음"
       ↓
재전송: [2]
       ↓
수신: [1][2][3][4][5] ← 순서대로 정렬
```

#### UDP - 최선 노력 전송
```
송신: [1][2][3][4][5]
       ↓
네트워크: [2] 손실
       ↓
수신: [1][3][4][5] ← 손실된 채로 전달
```

### 4. 헤더 구조 비교

#### TCP 헤더 (20~60 bytes)
```
┌─────────────────────────────────────┐
│ Source Port    │ Destination Port  │  4 bytes
├─────────────────────────────────────┤
│         Sequence Number             │  4 bytes
├─────────────────────────────────────┤
│       Acknowledgment Number         │  4 bytes
├─────────────────────────────────────┤
│Offset│Reserved│Flags│   Window     │  4 bytes
├─────────────────────────────────────┤
│    Checksum    │   Urgent Pointer  │  4 bytes
├─────────────────────────────────────┤
│            Options (optional)       │  0-40 bytes
└─────────────────────────────────────┘
```

#### UDP 헤더 (8 bytes)
```
┌─────────────────────────────────────┐
│ Source Port    │ Destination Port  │  4 bytes
├─────────────────────────────────────┤
│     Length     │     Checksum      │  4 bytes
└─────────────────────────────────────┘
```

**오버헤드 차이**: TCP는 UDP보다 최소 12바이트 더 큼

### 5. 사용 시나리오

#### TCP가 적합한 경우

| 시나리오 | 이유 |
|----------|------|
| 웹 브라우징 (HTTP/HTTPS) | 페이지가 완전히 로드되어야 함 |
| 이메일 (SMTP, IMAP) | 메시지 손실 불가 |
| 파일 전송 (FTP) | 파일 무결성 필수 |
| 원격 접속 (SSH) | 명령어 손실 시 문제 |
| 데이터베이스 연결 | 트랜잭션 무결성 |

```
웹 페이지 로딩:
[HTML] → [CSS] → [JS] → [Images]
       모든 리소스가 완전히 전달되어야 함
```

#### UDP가 적합한 경우

| 시나리오 | 이유 |
|----------|------|
| 실시간 스트리밍 | 지연 > 손실 |
| 온라인 게임 | 빠른 응답 필요 |
| VoIP | 실시간 통화 |
| DNS 조회 | 짧은 요청/응답 |
| IoT 센서 데이터 | 연속 데이터, 일부 손실 무관 |

```
실시간 스트리밍:
Frame1 → Frame2 → [Frame3 손실] → Frame4 → Frame5
                        ↓
              재전송 기다리면 영상 끊김
              → 다음 프레임으로 진행
```

### 6. 성능 비교

#### 지연 시간 (Latency)
```
TCP 첫 데이터 전송:
[SYN] → [SYN+ACK] → [ACK] → [Data]
        1 RTT        +      데이터 전송

UDP 첫 데이터 전송:
[Data]
즉시 전송
```

#### 처리량 (Throughput)
- TCP: 혼잡 제어로 인해 동적 조절
- UDP: 애플리케이션이 결정, 제한 없음

#### 오버헤드
```
1000개의 100바이트 메시지 전송 시 헤더 오버헤드:
TCP: 1000 × 20 = 20,000 bytes (최소)
UDP: 1000 × 8 = 8,000 bytes
```

### 7. 하이브리드 접근법

#### QUIC (HTTP/3)
- UDP 기반 + TCP의 신뢰성
- 빠른 연결 설정 (0-RTT)
- 멀티플렉싱
- 암호화 내장

```
TCP+TLS:
[SYN] → [SYN+ACK] → [ACK] → [TLS 핸드셰이크] → [Data]
        1 RTT              + 1-2 RTT

QUIC:
[Initial+Crypto+Data]
0-1 RTT (재연결 시 0-RTT)
```

#### 애플리케이션 레벨 신뢰성
```
UDP + 자체 ACK 구현:
Client                    Server
   |  -- Data(seq=1) --->    |
   |  <--- ACK(1) -------    |
   |  -- Data(seq=2) --->    |  (손실)
   |  [Timeout]              |
   |  -- Data(seq=2) --->    |  (재전송)
   |  <--- ACK(2) -------    |
```

## 선택 가이드

### 결정 트리

```
데이터 손실이 허용되는가?
├── Yes → 실시간성이 중요한가?
│         ├── Yes → UDP
│         └── No  → TCP (안전한 선택)
└── No  → TCP
```

### 체크리스트

**TCP 선택 조건**:
- [ ] 모든 데이터가 정확히 도착해야 함
- [ ] 순서가 중요함
- [ ] 신뢰성이 최우선
- [ ] 연결 설정 오버헤드 감수 가능

**UDP 선택 조건**:
- [ ] 실시간성이 중요함
- [ ] 약간의 손실 허용 가능
- [ ] 낮은 지연이 필수
- [ ] 브로드캐스트/멀티캐스트 필요
- [ ] 자체 신뢰성 메커니즘 구현 가능

## 참고 자료

- [RFC 793 - TCP](https://tools.ietf.org/html/rfc793)
- [RFC 768 - UDP](https://tools.ietf.org/html/rfc768)
- [RFC 9000 - QUIC](https://tools.ietf.org/html/rfc9000)
